{% extends "base.html" %}
{% block title %}Portfolio Research{% endblock %}

{% block content %}
<div class="panel">
  <h2>Portfolio Backtest</h2>

  <div class="grid grid-3">
    <div>
      <label>Tickers (comma separated)</label>
      <input id="pf-tickers" type="text" value="AAPL,MSFT,GOOGL,AMZN" />
    </div>
    <div>
      <label>Start</label>
      <input id="pf-start" type="date" value="2015-01-01" />
    </div>
    <div>
      <label>Signal</label>
      <input id="pf-signal" type="text" value="prob_up_1d" />
      <small>Can be any model prob_* or factor (e.g., mom_20)</small>
    </div>
    <div>
      <label>Allocator</label>
      <select id="pf-allocator">
        <option value="equal_weight">equal_weight</option>
        <option value="risk_parity">risk_parity</option>
        <option value="mean_variance">mean_variance</option>
      </select>
    </div>
    <div>
      <label>Rebalance</label>
      <select id="pf-rebalance">
        <option value="weekly">weekly</option>
        <option value="monthly">monthly</option>
        <option value="daily">daily</option>
      </select>
    </div>
    <div>
      <label>Cost (bps)</label>
      <input id="pf-cost" type="number" value="5" />
    </div>
  </div>

  <div class="row">
    <button id="pf-run">Run</button>

    <label class="toggle">
      <input id="pf-show-decay" type="checkbox" />
      <span>IC vs Horizon</span>
    </label>

    <label class="toggle">
      <input id="pf-show-quant" type="checkbox" />
      <span>Quantile Long-Short</span>
    </label>
  </div>
</div>

<div class="panel">
  <h3>Portfolio Equity</h3>
  <div id="pf-equity" class="chart"></div>
  <div class="metrics" id="pf-metrics"></div>
</div>

<div class="panel">
  <h3>Weights Heatmap</h3>
  <div id="pf-weights" class="chart tall"></div>
</div>

<div class="panel">
  <h3>Fama–French Factor Exposures</h3>
  <div id="pf-ff" class="chart"></div>
</div>

<div id="pf-extras" style="display:none;">
  <div class="panel">
    <h3>IC vs Holding Horizon</h3>
    <div id="pf-ic" class="chart"></div>
  </div>
  <div class="panel">
    <h3>Quantile Long-Short (Q5 − Q1)</h3>
    <div id="pf-qs" class="chart"></div>
  </div>
</div>
{% endblock %}

{% block scripts %}
<script src="https://cdn.plot.ly/plotly-2.30.0.min.js"></script>
<script>
  // page init
  window.addEventListener("DOMContentLoaded", () => {
    if (window.PF && typeof window.PF.init === "function") {
      window.PF.init();
    }
  });
</script>
{% endblock %}
